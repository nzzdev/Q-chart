<!-- index.html to test what markup would look like locally (independent of target) -->
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Q Renderer Skeleton</title>
    <meta name="description" content="">
    <link rel="stylesheet" href="https://service.sophie.nzz.ch/bundle/sophie-q@^1,sophie-font@^1,sophie-color@^1,sophie-viz-color@^1[general].css">
    <script src="https://rawgit.com/filamentgroup/loadCSS/master/src/loadCSS.js"></script> 
  </head>
  <body>
    <script src="node_modules/systemjs/dist/system.js"></script>    
    <div id="container">
      <div id="renderer"></div>
    </div>
    <script>
      let data = {
        "toolRuntimeConfig": {
          id: "1221asdasd",
          toolBaseUrl: 'http://localhost:3000'
        },
        "item": {
  "_id": "29aee9dcd77b766ea301518399fb5610",
  "_rev": "3-9301508d60d4407244988ae938989fec",
  "department": "Wirtschaft",
  "annotations": "",
  "title": "Zeit fÃ¼r eine Anhebung",
  "subtitle": "Untertitle der sehr lang ist und auch mal umbrechen kann wenns denn noetig ist weil zu wenig Platz da ist",
  "tool": "chart",
  "data": [
    [
      "Date",
      "Inflation in der Euro-Zone",
      "Hauptrefinanzierungssatz der EZB",
      "2-Prozent-Ziel der EZB"
    ],
    [
      "31.12.1998",
      "1.7",
      "3",
      "2"
    ],
    [
      "31.03.1999",
      "0.9",
      "3",
      "2"
    ],
    [
      "30.06.1999",
      "0.9",
      "2.5",
      "2"
    ],
    [
      "30.09.1999",
      "1.2",
      "2.5",
      "2"
    ],
    [
      "31.12.1999",
      "1.7",
      "3",
      "2"
    ],
    [
      "31.03.2000",
      "2",
      "3.5",
      "2"
    ],
    [
      "30.06.2000",
      "2.1",
      "4.25",
      "2"
    ],
    [
      "29.09.2000",
      "2.4",
      "4.5",
      "2"
    ],
    [
      "29.12.2000",
      "2.5",
      "4.75",
      "2"
    ],
    [
      "30.03.2001",
      "2.2",
      "4.75",
      "2"
    ],
    [
      "29.06.2001",
      "2.9",
      "4.5",
      "2"
    ],
    [
      "28.09.2001",
      "2.2",
      "3.75",
      "2"
    ],
    [
      "31.12.2001",
      "2.1",
      "3.25",
      "2"
    ],
    [
      "29.03.2002",
      "2.5",
      "3.25",
      "2"
    ],
    [
      "28.06.2002",
      "1.9",
      "3.25",
      "2"
    ],
    [
      "30.09.2002",
      "2.1",
      "3.25",
      "2"
    ],
    [
      "31.12.2002",
      "2.3",
      "2.75",
      "2"
    ],
    [
      "31.03.2003",
      "2.4",
      "2.5",
      "2"
    ],
    [
      "30.06.2003",
      "2",
      "2",
      "2"
    ],
    [
      "30.09.2003",
      "2.1",
      "2",
      "2"
    ],
    [
      "31.12.2003",
      "2",
      "2",
      "2"
    ],
    [
      "31.03.2004",
      "1.7",
      "2",
      "2"
    ],
    [
      "30.06.2004",
      "2.4",
      "2",
      "2"
    ],
    [
      "30.09.2004",
      "2.1",
      "2",
      "2"
    ],
    [
      "31.12.2004",
      "2.3",
      "2",
      "2"
    ],
    [
      "31.03.2005",
      "2.2",
      "2",
      "2"
    ],
    [
      "30.06.2005",
      "2",
      "2",
      "2"
    ],
    [
      "30.09.2005",
      "2.6",
      "2",
      "2"
    ],
    [
      "30.12.2005",
      "2.3",
      "2.25",
      "2"
    ],
    [
      "31.03.2006",
      "2.2",
      "2.5",
      "2"
    ],
    [
      "30.06.2006",
      "2.5",
      "2.75",
      "2"
    ],
    [
      "29.09.2006",
      "1.8",
      "3",
      "2"
    ],
    [
      "29.12.2006",
      "1.9",
      "3.5",
      "2"
    ],
    [
      "30.03.2007",
      "1.9",
      "3.75",
      "2"
    ],
    [
      "29.06.2007",
      "1.9",
      "4",
      "2"
    ],
    [
      "28.09.2007",
      "2.1",
      "4",
      "2"
    ],
    [
      "31.12.2007",
      "3.1",
      "4",
      "2"
    ],
    [
      "31.03.2008",
      "3.6",
      "4",
      "2"
    ],
    [
      "30.06.2008",
      "4",
      "4",
      "2"
    ],
    [
      "30.09.2008",
      "3.6",
      "4.25",
      "2"
    ],
    [
      "31.12.2008",
      "1.6",
      "2.5",
      "2"
    ],
    [
      "31.03.2009",
      "0.6",
      "1.5",
      "2"
    ],
    [
      "30.06.2009",
      "-0.1",
      "1",
      "2"
    ],
    [
      "30.09.2009",
      "-0.3",
      "1",
      "2"
    ],
    [
      "31.12.2009",
      "0.9",
      "1",
      "2"
    ],
    [
      "31.03.2010",
      "1.6",
      "1",
      "2"
    ],
    [
      "30.06.2010",
      "1.5",
      "1",
      "2"
    ],
    [
      "30.09.2010",
      "1.9",
      "1",
      "2"
    ],
    [
      "31.12.2010",
      "2.2",
      "1",
      "2"
    ],
    [
      "31.03.2011",
      "2.7",
      "1",
      "2"
    ],
    [
      "30.06.2011",
      "2.7",
      "1.25",
      "2"
    ],
    [
      "30.09.2011",
      "3",
      "1.5",
      "2"
    ],
    [
      "30.12.2011",
      "2.8",
      "1",
      "2"
    ],
    [
      "30.03.2012",
      "2.7",
      "1",
      "2"
    ],
    [
      "29.06.2012",
      "2.4",
      "1",
      "2"
    ],
    [
      "28.09.2012",
      "2.6",
      "0.75",
      "2"
    ],
    [
      "31.12.2012",
      "2.2",
      "0.75",
      "2"
    ],
    [
      "29.03.2013",
      "1.7",
      "0.75",
      "2"
    ],
    [
      "28.06.2013",
      "1.6",
      "0.5",
      "2"
    ],
    [
      "30.09.2013",
      "1.1",
      "0.5",
      "2"
    ],
    [
      "31.12.2013",
      "0.8",
      "0.25",
      "2"
    ],
    [
      "31.03.2014",
      "0.5",
      "0.25",
      "2"
    ],
    [
      "30.06.2014",
      "0.5",
      "0.15",
      "2"
    ],
    [
      "30.09.2014",
      "0.3",
      "0.05",
      "2"
    ],
    [
      "31.12.2014",
      "-0.2",
      "0.05",
      "2"
    ],
    [
      "31.03.2015",
      "-0.1",
      "0.05",
      "2"
    ],
    [
      "30.06.2015",
      "0.2",
      "0.05",
      "2"
    ],
    [
      "30.09.2015",
      "-0.1",
      "0.05",
      "2"
    ],
    [
      "31.12.2015",
      "0.2",
      "0.05",
      "2"
    ],
    [
      "31.03.2016",
      "0",
      "0",
      "2"
    ],
    [
      "30.06.2016",
      "0.1",
      "0",
      "2"
    ],
    [
      "30.09.2016",
      "0.4",
      "0",
      "2"
    ],
    [
      "30.12.2016",
      "1.1",
      "0",
      "2"
    ],
    [
      "31.03.2017",
      "1.5",
      "0",
      "2"
    ],
    [
      "07.06.2017",
      "1.4",
      "0",
      "2"
    ]
  ],
  "options": {
    "chartType": "Bar",
    "barOptions": {},
    "lineChartOptions": {},
    "dateSeriesOptions": {
      "interval": "year",
      "prognosisStart": null
    },
    "highlightDataSeries": 1,
    "colorOverwrite": [
      {
        "color": "red",
        "colorBright": "purple",
        "position": 1
      }
    ],
  },
  "sources": [
    {
      "text": "EZB, Eurostat",
      "link": {
        "url": "",
        "isValid": false
      }
    }
  ],
  "createdDate": "2017-06-08T10:06:06.048Z",
  "createdBy": "christian.steiner@nzz.ch",
  "active": true,
  "activateDate": "2017-06-08T10:08:25.657Z",
  "updatedBy": "beni.buess@nzz.ch",
  "updatedDate": "2017-06-10T15:49:04.477Z"
}
      };

      function loadAllScripts(scripts, index, callback) {
        if (scripts[index] && scripts[index].url) {
          loadJS(scripts[index].url, () => {
            loadAllScripts(scripts, index + 1, callback)
          })
        } else {
          callback();
        }
      }

      fetch(`http://localhost:3000/rendering-info/html-js`, {
          method: 'POST',
          body: JSON.stringify(data),
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => {
          return response.json();
        })
        .then(data => {
          data.stylesheets.forEach(stylesheet => {
            if (stylesheet.name) {
              stylesheet.url = `http://localhost:3000/stylesheet/${stylesheet.name}`
            }
            loadCSS(stylesheet.url)
          })
          document.getElementById('renderer').innerHTML = data.markup;

          data.scripts = data.scripts
            .map(script => {
              if (script.name) {
                script.url = `http://${window.location.hostname}:3000/script/${script.name}`
              }
              return script;
            })

          let urlScripts = data.scripts
            .filter(script => script.url)

          let contentScripts = data.scripts
            .filter(script => script.content)

          loadAllScripts(urlScripts, 0, () => {
            contentScripts.forEach(script => {
              let scriptElement = document.createElement('script');
              scriptElement.innerHTML = script.content;
              document.getElementById('container').appendChild(scriptElement);
            })
          })
        })
    </script>
  </body>
</html>
