<!-- index.html to test what markup would look like locally (independent of target) -->
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Q Renderer Skeleton</title>
    <meta name="description" content="">
    <link rel="stylesheet" href="https://service.sophie.nzz.ch/bundle/sophie-q@^1,sophie-font@^1,sophie-color@^1,sophie-viz-color@^1[general].css">
    <script src="https://rawgit.com/filamentgroup/loadCSS/master/src/loadCSS.js"></script> 
  </head>
  <body>
    <script src="node_modules/systemjs/dist/system.js"></script>    
    <div id="container">
      <div id="renderer"></div>
    </div>
    <script>
      let data = {
        "toolRuntimeConfig": {
          id: "1221asdasd",
          toolBaseUrl: 'http://localhost:3000'
        },
        "item": {
          _id: '_1',
          title: 'C1 Hummeln fliegen besser als gedacht ðŸ’€ðŸ‘Š',
          tool: 'chart',
          sources: [
            {
              "text": "Comparis",
              "href": "https://www.comparis.ch/comparis/press/medienmitteilungen/artikel/2016/immobilien/monatsmiete-vergleich/mietpreise-staedte.aspx",
              "validHref": true
            },
            {
              "text": "WÃ¼est & Partner Immo-Monitoring 2/2016",
              "href": "",
              "validHref": false
            }
          ],
          data: {
            x: {
              label: '',
              data: ['2011-05-01 00:00:00','2011-05-01 10:30:00','2011-05-01 11:00:00','2011-05-01 11:30:00'],
              type: {
                id: 'date',
                config: {
                  format: 'YYYY-MM-DD HH:MM:SS'
                },
                options: {
                  interval: 'hour'
                }
              }
            },
            y: {
              label: 'Flugpunkte',
              data: [
                {
                  label: 'Hummeln',
                  data: [531.10,150.00,475.70,421.45]
                },
                {
                  label: 'Fliegen',
                  data: [12,232.00,23.70,23.45]
                },
                {
                  label: 'FÃ¼chse',
                  data: [123.10,34.00,51.70,515.45]
                }
              ]
            }
          },
          notes: "Dieses Diagramm zeigt die Anzahl der Haustiere pro Fahrrard im Kanton ZÃ¼rich Ã¼ber die letzten zehn Jahre. Quellen: Amt fÃ¼r PilzprÃ¼fung; Haustieramt; Deine Mutter â€“ Beteiligte: Peter Lustig; Luise Honig; Franz Brand",
          chartConfig: {

          },
          type: 'Line'
        }
      };

      function loadAllScripts(scripts, index, callback) {
        if (scripts[index] && scripts[index].url) {
          loadJS(scripts[index].url, () => {
            loadAllScripts(scripts, index + 1, callback)
          })
        } else {
          callback();
        }
      }

      fetch(`http://localhost:3000/rendering-info/html-js`, {
          method: 'POST',
          body: JSON.stringify(data),
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => {
          return response.json();
        })
        .then(data => {
          data.stylesheets.forEach(stylesheet => {
            if (stylesheet.name) {
              stylesheet.url = `http://localhost:3000/stylesheet/${stylesheet.name}`
            }
            loadCSS(stylesheet.url)
          })
          document.getElementById('renderer').innerHTML = data.markup;

          data.scripts = data.scripts
            .map(script => {
              if (script.name) {
                script.url = `http://${window.location.hostname}:3000/script/${script.name}`
              }
              return script;
            })

          let urlScripts = data.scripts
            .filter(script => script.url)

          let contentScripts = data.scripts
            .filter(script => script.content)

          loadAllScripts(urlScripts, 0, () => {
            contentScripts.forEach(script => {
              let scriptElement = document.createElement('script');
              scriptElement.innerHTML = script.content;
              document.getElementById('container').appendChild(scriptElement);
            })
          })
        })
    </script>
  </body>
</html>
